<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conector Google Sheets - Innovemos</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .status-info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
        
        .log-area {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-top: 20px;
        }
        
        .instructions {
            background: #fff3e0;
            border: 1px solid #ffcc02;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .demo-form {
            background: #f1f8ff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Conector REAL Google Sheets - Programa Innovemos</h1>
        
        <div class="instructions">
            <h3>üìã Configuraci√≥n REAL de Google Sheets API:</h3>
            <p><strong>1.</strong> Ingresa tu Client ID de Google Cloud Console</p>
            <p><strong>2.</strong> Ingresa el ID de tu Google Sheet</p>
            <p><strong>3.</strong> Inicializa la conexi√≥n (aparecer√° ventana de permisos de Google)</p>
            <p><strong>4.</strong> ¬°Los datos se enviar√°n REALMENTE a tu Google Sheet!</p>
        </div>

        <div class="section">
            <h3>‚öôÔ∏è Credenciales de Google</h3>
            
            <div class="form-group">
                <label for="clientId">Client ID de Google:</label>
                <input type="text" id="clientId" placeholder="123456789-abcdefg.apps.googleusercontent.com">
                <small>Obtenido de Google Cloud Console ‚Üí APIs y servicios ‚Üí Credenciales</small>
            </div>
            
            <div class="form-group">
                <label for="spreadsheetId">ID de Google Sheet:</label>
                <input type="text" id="spreadsheetId" placeholder="1A2B3C4D5E6F7G8H9I0J1K2L3M4N5O6P7Q8R">
                <small>Parte larga de la URL: docs.google.com/spreadsheets/d/[ESTE_ID]/edit</small>
            </div>
            
            <button class="btn" onclick="initializeGoogleAPI()" id="initBtn">üöÄ Inicializar Google Sheets API</button>
            <button class="btn btn-success" onclick="setupHeaders()" id="headerBtn" disabled>üìã Configurar Encabezados</button>
        </div>

        <div id="statusArea"></div>

        <div class="demo-form" id="dataForm" style="display: none;">
            <h3>üìù Formulario de Diagn√≥stico Empresarial</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="empresa">Nombre de Empresa:</label>
                    <input type="text" id="empresa" value="Mi Empresa Innovadora">
                </div>
                
                <div class="form-group">
                    <label for="sector">Sector:</label>
                    <select id="sector">
                        <option value="tecnologia">Tecnolog√≠a</option>
                        <option value="servicios">Servicios</option>
                        <option value="manufactura">Manufactura</option>
                        <option value="agropecuario">Agropecuario</option>
                        <option value="comercio">Comercio</option>
                    </select>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="responsable">Responsable:</label>
                    <input type="text" id="responsable" value="Juan P√©rez">
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" value="juan@miempresa.com">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="fortalezas">Fortalezas:</label>
                    <textarea id="fortalezas" rows="3">‚Ä¢ Equipo t√©cnico experimentado
‚Ä¢ Buenas relaciones con clientes
‚Ä¢ Procesos bien definidos</textarea>
                </div>
                
                <div class="form-group">
                    <label for="debilidades">Debilidades:</label>
                    <textarea id="debilidades" rows="3">‚Ä¢ Recursos financieros limitados
‚Ä¢ Falta de presencia digital
‚Ä¢ Procesos manuales</textarea>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="oportunidades">Oportunidades:</label>
                    <textarea id="oportunidades" rows="3">‚Ä¢ Crecimiento del mercado digital
‚Ä¢ Nuevas regulaciones favorables
‚Ä¢ Tendencias tecnol√≥gicas emergentes</textarea>
                </div>
                
                <div class="form-group">
                    <label for="amenazas">Amenazas:</label>
                    <textarea id="amenazas" rows="3">‚Ä¢ Competencia internacional
‚Ä¢ Cambios regulatorios
‚Ä¢ Inestabilidad econ√≥mica</textarea>
                </div>
            </div>
            
            <h4>üî¢ Ratings de Innovaci√≥n (1-5):</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <div>
                    <label>Procesos: <input type="range" id="procesos" min="1" max="5" value="3" oninput="updateValue('procesos')"> <span id="procesos-val">3</span></label>
                </div>
                <div>
                    <label>Tecnolog√≠as: <input type="range" id="tecnologias" min="1" max="5" value="4" oninput="updateValue('tecnologias')"> <span id="tecnologias-val">4</span></label>
                </div>
                <div>
                    <label>Productos: <input type="range" id="productos" min="1" max="5" value="3" oninput="updateValue('productos')"> <span id="productos-val">3</span></label>
                </div>
                <div>
                    <label>Servicios: <input type="range" id="servicios" min="1" max="5" value="4" oninput="updateValue('servicios')"> <span id="servicios-val">4</span></label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="prioridad">Tipo de Innovaci√≥n Prioritario:</label>
                <select id="prioridad">
                    <option value="tecnologias">Tecnolog√≠as</option>
                    <option value="procesos">Procesos</option>
                    <option value="productos">Productos</option>
                    <option value="servicios">Servicios</option>
                </select>
            </div>
            
            <button class="btn btn-success" onclick="sendToGoogleSheets()" id="sendBtn" disabled>üì§ ENVIAR A GOOGLE SHEETS</button>
            <button class="btn" onclick="openSheet()" id="openBtn" disabled>üåê Ver Google Sheet</button>
        </div>

        <div class="log-area" id="logArea">
            <div>[SISTEMA] Conector REAL inicializado - Configure sus credenciales</div>
        </div>
    </div>

    <script>
        // Variables globales
        let gapi = null;
        let isInitialized = false;
        let isAuthenticated = false;
        let currentSpreadsheetId = '';
        
        // Configuraci√≥n
        const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
        
        // Headers para el Google Sheet
        const HEADERS = [
            'Timestamp', 'Empresa', 'Sector', 'Responsable', 'Email',
            'Fortalezas', 'Debilidades', 'Oportunidades', 'Amenazas',
            'Rating_Procesos', 'Rating_Tecnologias', 'Rating_Productos', 'Rating_Servicios',
            'Tipo_Prioritario', 'Notas_Adicionales'
        ];
        
        // Funci√≥n para mostrar status
        function showStatus(message, type) {
            const statusArea = document.getElementById('statusArea');
            statusArea.innerHTML = `<div class="status status-${type}">${message}</div>`;
            log(message, type.toUpperCase());
        }
        
        // Funci√≥n para log
        function log(message, type = 'INFO') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'INFO': '#74b9ff',
                'SUCCESS': '#00b894',
                'ERROR': '#fd7979',
                'WARNING': '#fdcb6e'
            };
            
            const entry = document.createElement('div');
            entry.style.color = colors[type] || '#ffffff';
            entry.innerHTML = `[${timestamp}] [${type}] ${message}`;
            
            logArea.appendChild(entry);
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // Inicializar Google API
        async function initializeGoogleAPI() {
            const clientId = document.getElementById('clientId').value.trim();
            const spreadsheetId = document.getElementById('spreadsheetId').value.trim();
            
            if (!clientId || !spreadsheetId) {
                showStatus('‚ö†Ô∏è Complete ambos campos antes de inicializar', 'error');
                return;
            }
            
            if (!clientId.includes('.apps.googleusercontent.com')) {
                showStatus('‚ö†Ô∏è Client ID no tiene el formato correcto', 'error');
                return;
            }
            
            currentSpreadsheetId = spreadsheetId;
            
            try {
                log('Inicializando Google Sheets API...', 'INFO');
                document.getElementById('initBtn').disabled = true;
                document.getElementById('initBtn').textContent = 'üîÑ Inicializando...';
                
                // Cargar Google API
                await new Promise((resolve) => {
                    window.gapi.load('client:auth2', resolve);
                });
                
                // Inicializar cliente
                await window.gapi.client.init({
                    clientId: clientId,
                    discoveryDocs: [DISCOVERY_DOC],
                    scope: SCOPES
                });
                
                // Obtener instancia de autenticaci√≥n
                const authInstance = window.gapi.auth2.getAuthInstance();
                
                // Verificar si ya est√° autenticado
                if (authInstance.isSignedIn.get()) {
                    log('Usuario ya autenticado', 'SUCCESS');
                    onAuthSuccess();
                } else {
                    log('Iniciando proceso de autenticaci√≥n...', 'INFO');
                    await authInstance.signIn();
                    onAuthSuccess();
                }
                
            } catch (error) {
                log(`ERROR: ${error.message}`, 'ERROR');
                showStatus(`‚ùå Error: ${error.message}`, 'error');
                document.getElementById('initBtn').disabled = false;
                document.getElementById('initBtn').textContent = 'üöÄ Inicializar Google Sheets API';
            }
        }
        
        // Funci√≥n cuando la autenticaci√≥n es exitosa
        function onAuthSuccess() {
            isInitialized = true;
            isAuthenticated = true;
            
            showStatus('‚úÖ Conectado exitosamente a Google Sheets', 'success');
            log('Autenticaci√≥n exitosa', 'SUCCESS');
            
            document.getElementById('initBtn').textContent = '‚úÖ Conectado';
            document.getElementById('headerBtn').disabled = false;
            document.getElementById('sendBtn').disabled = false;
            document.getElementById('openBtn').disabled = false;
            document.getElementById('dataForm').style.display = 'block';
        }
        
        // Configurar encabezados en la hoja
        async function setupHeaders() {
            if (!isAuthenticated) {
                showStatus('‚ùå Primero debe autenticarse', 'error');
                return;
            }
            
            try {
                log('Configurando encabezados en Google Sheet...', 'INFO');
                document.getElementById('headerBtn').disabled = true;
                document.getElementById('headerBtn').textContent = 'üìã Configurando...';
                
                const response = await window.gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: currentSpreadsheetId,
                    range: 'A1:O1',
                    valueInputOption: 'RAW',
                    resource: {
                        values: [HEADERS]
                    }
                });
                
                log('Encabezados configurados correctamente', 'SUCCESS');
                showStatus('‚úÖ Encabezados configurados en la hoja', 'success');
                
                document.getElementById('headerBtn').textContent = '‚úÖ Configurado';
                
            } catch (error) {
                log(`ERROR configurando encabezados: ${error.message}`, 'ERROR');
                showStatus(`‚ùå Error: ${error.message}`, 'error');
                document.getElementById('headerBtn').disabled = false;
                document.getElementById('headerBtn').textContent = 'üìã Configurar Encabezados';
            }
        }
        
        // Enviar datos a Google Sheets
        async function sendToGoogleSheets() {
            if (!isAuthenticated) {
                showStatus('‚ùå Primero debe autenticarse', 'error');
                return;
            }
            
            try {
                log('Enviando datos a Google Sheets...', 'INFO');
                document.getElementById('sendBtn').disabled = true;
                document.getElementById('sendBtn').textContent = 'üì§ Enviando...';
                
                // Recopilar datos del formulario
                const rowData = [
                    new Date().toLocaleString('es-CO'),
                    document.getElementById('empresa').value,
                    document.getElementById('sector').value,
                    document.getElementById('responsable').value,
                    document.getElementById('email').value,
                    document.getElementById('fortalezas').value,
                    document.getElementById('debilidades').value,
                    document.getElementById('oportunidades').value,
                    document.getElementById('amenazas').value,
                    document.getElementById('procesos').value,
                    document.getElementById('tecnologias').value,
                    document.getElementById('productos').value,
                    document.getElementById('servicios').value,
                    document.getElementById('prioridad').value,
                    'Datos enviados desde aplicaci√≥n web'
                ];
                
                // Enviar a Google Sheets
                const response = await window.gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: currentSpreadsheetId,
                    range: 'A:O',
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: {
                        values: [rowData]
                    }
                });
                
                log('¬°DATOS ENVIADOS EXITOSAMENTE!', 'SUCCESS');
                showStatus('‚úÖ ¬°Datos enviados correctamente a Google Sheets!', 'success');
                
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('sendBtn').textContent = 'üì§ ENVIAR A GOOGLE SHEETS';
                
                log(`Fila agregada en rango: ${response.result.updates.updatedRange}`, 'INFO');
                
            } catch (error) {
                log(`ERROR enviando datos: ${error.message}`, 'ERROR');
                showStatus(`‚ùå Error: ${error.message}`, 'error');
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('sendBtn').textContent = 'üì§ ENVIAR A GOOGLE SHEETS';
            }
        }
        
        // Funci√≥n para actualizar valores de sliders
        function updateValue(id) {
            const slider = document.getElementById(id);
            const valueSpan = document.getElementById(id + '-val');
            valueSpan.textContent = slider.value;
        }
        
        // Abrir Google Sheet
        function openSheet() {
            const url = `https://docs.google.com/spreadsheets/d/${currentSpreadsheetId}/edit`;
            log(`Abriendo Google Sheet: ${url}`, 'INFO');
            window.open(url, '_blank');
        }
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            log('Sistema cargado - Ingrese credenciales para continuar', 'SUCCESS');
        });
    </script>
</body>
</html>
